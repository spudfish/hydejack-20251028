{%- comment -%}
Template for each Top Work item.
Receives front-matter values from the _top-work/ collection.
Handles text, call_to_action, and image linking/normalization.
{%- endcomment -%}

<div class="top-work">

  <!-- [1] TEXT BLOCK -->
  <div class="top-work__text">

    <!-- [1a] Title -->
    <h3 class="top-work__title">{{ include.title }}</h3>

<!-- [1c] Call to action (always present, supports Markdown) -->
<p class="top-work__call">
  {{ include.call_to_action
     | markdownify
     | replace: '<a href="', '<a target="_blank" rel="noopener" href="' }}
</p>

    <!-- [1b] Description (supports Markdown) -->
    {% if include.desc %}
      <div class="top-work__desc">
        {{ include.desc | markdownify }}
      </div>
    {% endif %}

  </div>
  <!-- [END TEXT BLOCK] -->

 <!-- [2] IMAGE BLOCK -->
  {% assign img_src = include.image %}

  {% if include.image_file %}
    {% if include.image == nil or include.image == '' %}
      {% assign img_src = '/assets/media/' | append: include.image_file %}
    {% endif %}
  {% endif %}
  
  {% if img_src %}
    {% unless img_src contains '://' %}
      {% assign first_char = img_src | slice: 0, 1 %}
      {% if first_char != '/' %}
        {% assign img_src = '/' | append: img_src %}
      {% endif %}
      {% assign img_src = img_src | relative_url %}
    {% endunless %}
  {% endif %}

  {% assign link_href = include.image_link %}
  {% if link_href %}
    {% unless link_href contains '://' %}
      {% assign first_char = link_href | slice: 0, 1 %}
      {% if first_char != '/' %}
        {% assign link_href = '/' | append: link_href %}
      {% endif %}
      {% assign link_href = link_href | relative_url %}
    {% endunless %}
  {% endif %}

  {% if img_src %}
    <div class="top-work__image">

      <!-- [2a] If image_link is provided, wrap image in <a> -->
      {% if link_href %}
        <a href="{{ link_href }}" target="_blank" rel="noopener">
          <img src="{{ img_src }}" alt="{{ include.image_alt | default: include.title }}">
        </a>
      {% else %}
        <!-- [2b] Otherwise, plain image -->
        <img src="{{ img_src }}" alt="{{ include.image_alt | default: include.title }}">
      {% endif %}

    </div>
  {% endif %}
  <!-- [END IMAGE BLOCK] -->

</div>

<!-- [3] Divider line between entries -->
<hr class="top-work__rule">
